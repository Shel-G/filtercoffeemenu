<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SEA Cupping Lineup â€¢ äº’åŠ¨åœ°å›¾ + åŒæ­¥å¡ç‰‡</title>
<meta name="description" content="ä¸€ä¸ªæ ¹æ®çƒ˜ç„™å•†å›½å®¶è¿›è¡Œç­›é€‰çš„äº’åŠ¨å’–å•¡è±†åœ°å›¾ã€‚">

<!-- External Libraries -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">

<style>
  :root {
    --bg1: #0f0a06;
    --bg2: #2a1b12;
    --panel: rgba(17, 20, 24, 0.7);
    --ink: #f2efe9;
    --sub: #d0c6bb;
    --accent: #f7c96e;
    --border: rgba(247, 201, 110, 0.2);
  }
  * { box-sizing: border-box; }
  html, body { 
    height: 100%; 
    margin: 0;
    overflow: hidden; /* Prevent body scroll when detail panel is open */
  }
  body {
    font-family: 'Inter', 'Noto Sans SC', system-ui, -apple-system, sans-serif;
    background: radial-gradient(1200px 800px at 15% 10%, rgba(247, 201, 110, 0.1), transparent 60%),
                radial-gradient(900px 700px at 85% 90%, rgba(247, 201, 110, 0.08), transparent 60%),
                linear-gradient(135deg, var(--bg1), var(--bg2));
    color: var(--ink);
  }
  .wrap {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    padding: 1.5rem;
  }
  header {
    text-align: center;
    padding-bottom: 1.5rem;
    flex-shrink: 0;
  }
  h1 {
    font-size: clamp(2rem, 5vw, 2.8rem);
    margin: 0 0 1rem;
    color: var(--ink);
    font-weight: 800;
  }
  .intro-hint {
    font-size: 0.9rem;
    color: var(--sub);
    max-width: 600px;
    margin: -0.5rem auto 1.5rem;
    line-height: 1.6;
  }
  .filter-group {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    align-items: center;
    gap: .75rem;
  }
  .chip {
    background: rgba(0, 0, 0, .2);
    border: 1px solid var(--border);
    color: var(--sub);
    border-radius: 999px;
    padding: .6rem 1.2rem;
    cursor: pointer;
    font-weight: 600;
    transition: all .2s ease;
  }
  .chip:hover {
      background-color: rgba(0,0,0,.4);
      color: var(--ink);
  }
  .chip.active {
    background: var(--accent);
    color: var(--bg1);
    border-color: var(--accent);
    transform: scale(1.05);
  }
  #map-container {
      flex-grow: 1;
      position: relative;
  }
  #map {
    height: 100%;
    width: 100%;
    border-radius: 16px;
    background-color: var(--bg1);
    border: 1px solid var(--border);
  }

  /* --- Custom Map Marker & Popup Styles --- */
  .leaflet-div-icon {
    background: transparent;
    border: none;
  }
  .roaster-marker-container {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    transition: transform 0.2s ease;
    transform-origin: left center;
  }
  .roaster-marker-container:hover {
      transform: scale(1.1);
  }
  .roaster-dot-marker {
    background-color: var(--accent);
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: 3px solid rgba(247, 201, 110, 0.5);
    box-shadow: 0 0 10px var(--accent);
    animation: pulse 2s infinite;
    flex-shrink: 0;
  }
   .roaster-name-label {
    background-color: rgba(15, 10, 6, 0.85);
    backdrop-filter: blur(4px);
    color: var(--accent);
    padding: 4px 8px;
    border-radius: 5px;
    border: 1px solid var(--border);
    font-size: 12px;
    font-weight: 600;
    white-space: nowrap;
    box-shadow: 0 2px 5px rgba(0,0,0,0.5);
  }

  @keyframes pulse {
    0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(247, 201, 110, 0.7); }
    70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(247, 201, 110, 0); }
    100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(247, 201, 110, 0); }
  }

  /* --- Detail Panel Styles --- */
  .detail-panel-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      backdrop-filter: blur(5px);
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
  }
  .detail-panel {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 75vh;
      background: linear-gradient(135deg, var(--bg2), var(--bg1));
      border-top: 1px solid var(--border);
      border-radius: 20px 20px 0 0;
      z-index: 1001;
      transform: translateY(100%);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      padding: 2rem;
      overflow-y: auto;
      box-shadow: 0 -10px 30px rgba(0,0,0,0.3);
  }
   .detail-panel-overlay.is-visible {
      opacity: 1;
      visibility: visible;
  }
  .detail-panel-overlay.is-visible .detail-panel {
      transform: translateY(0);
  }
  .detail-content {
      max-width: 800px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr;
      gap: 2rem;
      opacity: 0;
      transform: translateY(15px);
      transition: opacity 0.3s ease 0.1s, transform 0.3s ease 0.1s;
  }
  .detail-panel-overlay.is-visible .detail-content {
      opacity: 1;
      transform: translateY(0);
  }
  @media(min-width: 768px){
      .detail-content { grid-template-columns: 300px 1fr; }
  }
  .detail-fig {
    position: relative;
    min-height: 250px;
    background-color: rgba(0,0,0,0.2);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .detail-fig.is-loading::after {
    content: '';
    width: 40px;
    height: 40px;
    border: 4px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    position: absolute;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  
  .detail-fig img {
      width: 100%;
      height: auto;
      border-radius: 12px;
      object-fit: cover;
      opacity: 0;
      transition: opacity 0.4s ease;
  }
  .detail-fig img.is-loaded {
      opacity: 1;
  }

  .detail-body .title {
      font-size: 2rem;
      margin: 0 0 .5rem;
      font-weight: 800;
      color: var(--accent);
  }
  .detail-body .meta {
      list-style: none;
      padding: 0;
      margin: 0;
      color: var(--sub);
      line-height: 1.8;
  }
  .detail-body .meta strong {
    color: var(--ink);
    font-weight: 600;
    min-width: 80px;
    display: inline-block;
  }
  .detail-body .flavors {
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--border);
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
  }
  .flavor-tag {
    background-color: rgba(0,0,0,0.3);
    border: 1px solid var(--border);
    padding: 0.25rem 0.75rem;
    border-radius: 999px;
    font-size: 0.9rem;
  }
  .close-btn {
      position: absolute;
      top: 1rem;
      right: 1.5rem;
      background: none;
      border: none;
      color: var(--sub);
      font-size: 2rem;
      cursor: pointer;
      line-height: 1;
      z-index: 20;
  }
  .nav-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0,0,0,0.5);
    color: white;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: none; /* Hidden by default */
    align-items: center;
    justify-content: center;
    font-size: 24px;
    cursor: pointer;
    user-select: none;
    transition: background 0.2s;
    z-index: 10;
  }
  .nav-arrow.visible {
      display: flex;
  }
  .nav-arrow:hover {
      background: rgba(0,0,0,0.8);
  }
  .nav-arrow.left { left: 10px; }
  .nav-arrow.right { right: 10px; }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>SEA Cupping Lineup â€¢ äº’åŠ¨åœ°å›¾ + åŒæ­¥å¡ç‰‡</h1>
    <p class="intro-hint">ç‚¹å‡»ä¸Šæ–¹æŒ‰çƒ˜ç„™å•†æ‰€åœ¨å›½å®¶ç­›é€‰ï¼Œç‚¹å‡»åœ°å›¾ä¸Šçƒ˜ç„™å•†çš„åœ°ç†ä½ç½®æ ‡è®°ï¼Œä¼šè‡ªåŠ¨å±•ç¤ºæ­¤æ¬¡æ¯æµ‹è¯¥çƒ˜ç„™å•†å¯¹åº”çš„è±†å­å¡ç‰‡ä¿¡æ¯ã€‚</p>
    <div class="filter-group" id="country-chips">
      <button class="chip active" data-filter="all">å…¨éƒ¨å›½å®¶</button>
      <button class="chip" data-filter="é©¬æ¥è¥¿äºš">é©¬æ¥è¥¿äºš ğŸ‡²ğŸ‡¾</button>
      <button class="chip" data-filter="æ³°å›½">æ³°å›½ ğŸ‡¹ğŸ‡­</button>
      <button class="chip" data-filter="æ–°åŠ å¡">æ–°åŠ å¡ ğŸ‡¸ğŸ‡¬</button>
    </div>
  </header>
  <main id="map-container">
    <div id="map"></div>
  </main>
</div>

<div class="detail-panel-overlay" id="detail-panel-overlay">
  <div class="detail-panel">
    <button class="close-btn" id="close-btn">&times;</button>
    <div class="detail-content" id="detail-content">
      <!-- Detailed bean info will be injected here -->
    </div>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {

  const beansData = [
    { "NO": 1, "å›½å®¶": "é©¬æ¥è¥¿äºš", "äº§åŒº": "Johor", "è±†ç§": "Peaberry", "åº„å›­/ç”Ÿäº§è€…": "My Liberica, Jason Liew", "çƒ˜ç„™å•†": "One Half", "å¤„ç†æ³•": "JH æ—¥æ™’ 12å¤©", "æµ·æ‹”": "26-30 masl", "é£å‘³æè¿°": "ç”œèŠã€é¾™çœ¼ã€çº¢æ¯›ä¸¹ã€è²å¿ƒæœã€èå£«" },
    { "NO": 2, "å›½å®¶": "é©¬æ¥è¥¿äºš", "äº§åŒº": "Johor N26 Lot 1", "è±†ç§": "Liberaca", "åº„å›­/ç”Ÿäº§è€…": "My Liberica", "çƒ˜ç„™å•†": "Cloud Catcher Coffee", "å¤„ç†æ³•": "åŒæ°§æ—¥æ™’ 26å¤©", "æµ·æ‹”": "0-20m", "é£å‘³æè¿°": "é»‘æ¨±æ¡ƒã€æ³¡æ³¡ç³–ã€çº¢æ£ã€ç”œèŠ" },
    { "NO": 3, "å›½å®¶": "è¨å°”ç“¦å¤š", "äº§åŒº": "Santa Ana", "è±†ç§": "Bourbon", "åº„å›­/ç”Ÿäº§è€…": "El Martillo", "çƒ˜ç„™å•†": "VCR Coffee Roasters", "å¤„ç†æ³•": "åŒæ°§æ—¥æ™’", "æµ·æ‹”": "1650-1700 masl", "é£å‘³æè¿°": "ç™¾é¦™æœã€é»„è‘¡è„å¹²ã€æ" },
    { "NO": 4, "å›½å®¶": "æ³°å›½", "äº§åŒº": "Chiang Rai", "è±†ç§": "Catuai, Typica", "åº„å›­/ç”Ÿäº§è€…": "Hua Chang Nawin Yaesonkco", "çƒ˜ç„™å•†": "Curate Coffee Roasters", "å¤„ç†æ³•": "æ—¥æ™’è½¬é…µæ¯å‘é…µ", "æµ·æ‹”": null, "é£å‘³æè¿°": "æœ—å§†é…’ã€çº¢æ¨±æ¡ƒã€å·§å…‹åŠ›" },
    { "NO": 5, "å›½å®¶": "æ³°å›½", "äº§åŒº": "Tak", "è±†ç§": "Catimor, Catuai, Typica", "åº„å›­/ç”Ÿäº§è€…": "Chang Pao, Le Tor Gold", "çƒ˜ç„™å•†": "Lot of Taste", "å¤„ç†æ³•": "æ—¥æ™’", "æµ·æ‹”": null, "é£å‘³æè¿°": "æå­ã€è”—ç³–ã€é»‘è‘¡è„å¹²ã€ä½™éŸµå›ç”˜" },
    { "NO": 6, "å›½å®¶": "æ³°å›½", "äº§åŒº": "Tak", "è±†ç§": "Catimor, Catuai, Typica", "åº„å›­/ç”Ÿäº§è€…": "Chang Pao, Le Tor Gold", "çƒ˜ç„™å•†": "Lot of Taste", "å¤„ç†æ³•": "æ—¥æ™’", "æµ·æ‹”": null, "é£å‘³æè¿°": "ç«ç‘°ã€æ ‘è“ã€è¥¿æŸšã€è‘¡è„é…’ã€ä½™éŸµå›ç”˜" },
    { "NO": 7, "å›½å®¶": "æ³°å›½", "äº§åŒº": "Mae chaem, Chiang Mai", "è±†ç§": "Catimor, Catuai, Typica", "åº„å›­/ç”Ÿäº§è€…": "Mae Jam", "çƒ˜ç„™å•†": "Graph Coffee Co.", "å¤„ç†æ³•": "ä¼ ç»Ÿæ°´æ´—", "æµ·æ‹”": null, "é£å‘³æè¿°": "çº¢èŒ¶ã€çº¢ç³–ã€å‡¤æ¢¨ã€è èèœœ" },
    { "NO": 8, "å›½å®¶": "æ³°å›½", "äº§åŒº": "Maejan Tai, Chiang Rai", "è±†ç§": "Catimor, Mix", "åº„å›­/ç”Ÿäº§è€…": "Liger", "çƒ˜ç„™å•†": "Akha Ama Phrasingh", "å¤„ç†æ³•": "æ—¥æ™’", "æµ·æ‹”": "1400 masl", "é£å‘³æè¿°": "å·§å…‹åŠ›å¸ƒæœ—å°¼ã€è‘¡è„å¹²ã€è‚‰æ¡‚ã€çƒ­çº¢é…’ã€ç™¾é¦™æœ" },
    { "NO": 9, "å›½å®¶": "æ³°å›½", "äº§åŒº": "Doi Chang, Chiang Rai", "è±†ç§": "Typica, Catimor, Mix", "åº„å›­/ç”Ÿäº§è€…": "Apiwat", "çƒ˜ç„™å•†": "Akha Ama Phrasingh", "å¤„ç†æ³•": "æ°´æ´—", "æµ·æ‹”": "1200-1395 masl", "é£å‘³æè¿°": "è²é›¾ã€è¥¿ç“œã€æ¨æ¡ƒ" },
    { "NO": 10, "å›½å®¶": "ç§˜é²", "äº§åŒº": null, "è±†ç§": "Gesha", "åº„å›­/ç”Ÿäº§è€…": "Lorenzo Arbildo", "çƒ˜ç„™å•†": "Fluid", "å¤„ç†æ³•": "æ°´æ´—", "æµ·æ‹”": null, "é£å‘³æè¿°": "è‰è“ã€ç½å¤´æ¡ƒå­ã€èŠ±èŒ¶" },
    { "NO": 11, "å›½å®¶": "å°åº¦å°¼è¥¿äºš", "äº§åŒº": "Kintamani, Bali", "è±†ç§": "USDA, Cobra, Kopyol", "åº„å›­/ç”Ÿäº§è€…": "Nismara Singaraja", "çƒ˜ç„™å•†": "Tiong Hoe Specialty Coffee", "å¤„ç†æ³•": "ä¼ ç»Ÿæ°´æ´—", "æµ·æ‹”": null, "é£å‘³æè¿°": "çº¢ç³–ã€ç”˜è”—ã€å¹²æŸ¿å­" },
    { "NO": 12, "å›½å®¶": "å°¼åŠ æ‹‰ç“œ", "äº§åŒº": "Jinotega", "è±†ç§": "Catuai, Parainema", "åº„å›­/ç”Ÿäº§è€…": "Ramon Blandino", "çƒ˜ç„™å•†": "Cloud Catcher Coffee", "å¤„ç†æ³•": "æ°´æ´—", "æµ·æ‹”": "1600m", "é£å‘³æè¿°": "è²é›¾ã€æœ¨æ§¿èŠ±ã€æ¡ƒå­ã€æ©™å­" },
    { "NO": 13, "å›½å®¶": "åŸƒå¡ä¿„æ¯”äºš", "äº§åŒº": "Gomoro Guji G1", "è±†ç§": null, "åº„å›­/ç”Ÿäº§è€…": null, "çƒ˜ç„™å•†": "Artisan Roast Coffee", "å¤„ç†æ³•": null, "æµ·æ‹”": null, "é£å‘³æè¿°": "æ©™æ±ã€èŠ’æœã€æŸ æª¬å‘³ç¡¬ç³–" },
    { "NO": 14, "å›½å®¶": "å¦æ¡‘å°¼äºš", "äº§åŒº": null, "è±†ç§": "Bourbon (N39)", "åº„å›­/ç”Ÿäº§è€…": "Various Smallholder Producers", "çƒ˜ç„™å•†": "Nylon Coffee Roasters", "å¤„ç†æ³•": "æ°´æ´—", "æµ·æ‹”": null, "é£å‘³æè¿°": "å¹²æµ†æœã€é»‘å¸ƒæ—ã€é»‘è‘¡è„" }
  ];

  const roasterInfo = {
    "Akha Ama Phrasingh": { country: "æ³°å›½", city: "æ¸…è¿ˆ", lat: 18.7915, lng: 98.9820 },
    "Graph Coffee Co.": { country: "æ³°å›½", city: "æ¸…è¿ˆ", lat: 18.8030, lng: 98.9680 },
    "Lot of Taste": { country: "æ³°å›½", city: "æ¸…è¿ˆ", lat: 18.7845, lng: 99.0007 },
    "Artisan Roast Coffee": { country: "é©¬æ¥è¥¿äºš", city: "å‰éš†å¡", lat: 3.1385, lng: 101.6300 },
    "Cloud Catcher Coffee": { country: "é©¬æ¥è¥¿äºš", city: "å‰éš†å¡", lat: 3.1114, lng: 101.6750 },
    "Curate Coffee Roasters": { country: "é©¬æ¥è¥¿äºš", city: "å‰éš†å¡", lat: 3.1610, lng: 101.7180 },
    "One Half": { country: "é©¬æ¥è¥¿äºš", city: "å‰éš†å¡", lat: 3.1080, lng: 101.6240 },
    "VCR Coffee Roasters": { country: "é©¬æ¥è¥¿äºš", city: "å‰éš†å¡", lat: 3.1440, lng: 101.7080 },
    "Fluid": { country: "æ–°åŠ å¡", city: "æ–°åŠ å¡", lat: 1.3005, lng: 103.8580 },
    "Nylon Coffee Roasters": { country: "æ–°åŠ å¡", city: "æ–°åŠ å¡", lat: 1.2770, lng: 103.8420 },
    "Tiong Hoe Specialty Coffee": { country: "æ–°åŠ å¡", city: "æ–°åŠ å¡", lat: 1.2980, lng: 103.8050 },
  };
  
  const beansByRoaster = beansData.reduce((acc, bean) => {
    const roasterName = bean.çƒ˜ç„™å•†;
    if (!acc[roasterName]) { acc[roasterName] = []; }
    acc[roasterName].push(bean);
    return acc;
  }, {});

  const mapElement = document.getElementById('map');
  const countryChips = document.getElementById('country-chips');
  const detailOverlay = document.getElementById('detail-panel-overlay');
  const detailContent = document.getElementById('detail-content');
  const closeBtn = document.getElementById('close-btn');
  
  let currentCountryFilter = 'all';
  let currentRoasterBeans = [];
  let currentBeanIndex = 0;

  const map = L.map(mapElement, { scrollWheelZoom: false }).setView([8, 105], 4);
  L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
    maxZoom: 18
  }).addTo(map);

  const markers = L.layerGroup().addTo(map);

  function renderBeanInPanel(bean) {
    const flavorTags = bean.é£å‘³æè¿°.split('ã€').map(flavor => `<span class="flavor-tag">${flavor}</span>`).join('');
    const showNav = currentRoasterBeans.length > 1;

    detailContent.innerHTML = `
      <div class="detail-fig is-loading">
          <img data-src="https://raw.githubusercontent.com/Shel-G/filtercoffeemenu/main/${bean.NO}.png" alt="${bean.äº§åŒº}">
          <div class="nav-arrow left ${showNav ? 'visible' : ''}" id="nav-prev">&lt;</div>
          <div class="nav-arrow right ${showNav ? 'visible' : ''}" id="nav-next">&gt;</div>
      </div>
      <div class="detail-body">
          <h2 class="title">${bean.çƒ˜ç„™å•†} (#${bean.NO})</h2>
          <ul class="meta">
              <li><strong>äº§åŒº:</strong> ${bean.äº§åŒº || bean.å›½å®¶}</li>
              <li><strong>è±†ç§:</strong> ${bean.è±†ç§ || 'N/A'}</li>
              <li><strong>å¤„ç†æ³•:</strong> ${bean.å¤„ç†æ³• || 'N/A'}</li>
              <li><strong>ç”Ÿäº§è€…:</strong> ${bean['åº„å›­/ç”Ÿäº§è€…'] || 'N/A'}</li>
          </ul>
          <div class="flavors">${flavorTags}</div>
      </div>
    `;

    const figElement = detailContent.querySelector('.detail-fig');
    const imgElement = figElement.querySelector('img');
    
    imgElement.onload = () => {
        figElement.classList.remove('is-loading');
        imgElement.classList.add('is-loaded');
    };
    imgElement.onerror = () => {
        figElement.classList.remove('is-loading');
    };
    imgElement.src = imgElement.dataset.src;

    if(showNav) {
        document.getElementById('nav-prev').addEventListener('click', () => {
            currentBeanIndex = (currentBeanIndex - 1 + currentRoasterBeans.length) % currentRoasterBeans.length;
            renderBeanInPanel(currentRoasterBeans[currentBeanIndex]);
        });
        document.getElementById('nav-next').addEventListener('click', () => {
            currentBeanIndex = (currentBeanIndex + 1) % currentRoasterBeans.length;
            renderBeanInPanel(currentRoasterBeans[currentBeanIndex]);
        });
    }
  }

  function showDetailPanel(roasterName) {
      currentRoasterBeans = beansByRoaster[roasterName] || [];
      if (currentRoasterBeans.length === 0) return;
      
      currentBeanIndex = 0;
      renderBeanInPanel(currentRoasterBeans[currentBeanIndex]);
      detailOverlay.classList.add('is-visible');
  }

  function hideDetailPanel() {
      detailOverlay.classList.remove('is-visible');
  }

  function renderMarkers() {
      markers.clearLayers();
      const bounds = L.latLngBounds();
      
      Object.entries(roasterInfo).forEach(([roasterName, info]) => {
          if (currentCountryFilter !== 'all' && info.country !== currentCountryFilter) {
              return;
          }

          if (info.lat && info.lng) {
              const icon = L.divIcon({
                  className: 'leaflet-div-icon',
                  html: `<div class="roaster-marker-container">
                           <div class="roaster-dot-marker"></div>
                           <div class="roaster-name-label">${roasterName}</div>
                         </div>`,
                  iconSize: null,
                  iconAnchor: [6, 6]
              });

              const marker = L.marker([info.lat, info.lng], { icon: icon }).addTo(markers);
              
              marker.on('click', () => {
                showDetailPanel(roasterName);
              });
              bounds.extend([info.lat, info.lng]);
          }
      });

      if (bounds.isValid()) {
          map.fitBounds(bounds.pad(0.5));
      } else {
          map.setView([8, 105], 4);
      }
  }
  
  countryChips.addEventListener('click', (e) => {
    if (e.target.tagName === 'BUTTON') {
      countryChips.querySelector('.active').classList.remove('active');
      e.target.classList.add('active');
      currentCountryFilter = e.target.dataset.filter;
      renderMarkers();
    }
  });
  
  closeBtn.addEventListener('click', hideDetailPanel);
  detailOverlay.addEventListener('click', (e) => {
      if (e.target === detailOverlay) {
          hideDetailPanel();
      }
  });

  renderMarkers();
});
</script>
</body>
</html>

